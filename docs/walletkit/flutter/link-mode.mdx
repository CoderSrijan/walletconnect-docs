import PlatformTabs from '../../components/PlatformTabs'
import PlatformTabItem from '../../components/PlatformTabItem'

# Link Mode

**WalletKit Link Mode** is a low latency mechanism for transporting 1-click auth requests and session requests over universal links, eliminating the need for a WebSocket connection with the Relay. This significantly enhances the user experience when connecting native dApps to native wallets by reducing the latency associated with networking connections, especially when the user has an unstable internet connection.

By enabling it, wallet and dapp will communicate through declared Universal Links on iOS and/or App Links on Android.

### How to enable it:

1. Add an Universal Link/App Link for your wallet in Cloud project configuration dashboard

2. Configure your `PairingMetadata`'s `redirect:` object with that Universal Link/App Link

3. Set the `linkMode` property to `true`:

```dart
final web3Wallet = Web3Wallet(
  projectId: '123.....',
  metadata: PairingMetadata(
    // ...
    redirect: Redirect(
      native: 'yourwalletscheme://',
      universal: 'https://your_wallet_universal_link.com/open',
      linkMode: true,
    ),
  ),
);
```

Once everything is properly configured and the user interacts with a Link Mode supporting dApp, your Wallet will receive requests over it.

On Flutter there are different plugins that would help you integrate Universal/App Links but no matter which one you choose it is important that, when capturing an incoming link, you pass it to WalletKit so it can process them:

```dart
void _onLinkCaptured(String link) async {
  await web3Wallet.dispatchEnvelope(link);
}
```

### Platform specifics:

<PlatformTabs
	groupId="w3m_flutter"
	activeOptions={["ios","android"]}
>
<PlatformTabItem value="ios">

1. Ensure to handle incoming universal links in different methods of `AppDelegate` or `SceneDelegate`. 
2. Ensure that enabled the Associated Domains Capability in your Xcode project and that your Universal Link is properly configured
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
  <key>com.apple.developer.associated-domains</key>
  <array>
    <string>applinks:your_wallet_universal_link.com</string>
  </array>
</dict>
</plist>
```
_(Depending on the preivous states of your provisioning profiles it may be required to update/create new ones)_

3. Update/Create your Domain's `.well-known/apple-app-site-association` file accordingly


For more information on how to configure universal links for your app, refer to the [Apple Documentation](https://developer.apple.com/documentation/xcode/allowing-apps-and-websites-to-link-to-your-content?language=swift).<br />
For a debugging guide, visit the [Debugging Universal Links](https://developer.apple.com/documentation/technotes/tn3155-debugging-universal-links) page.<br />

You can check our Flutter Sample Wallet's [AppDelegate file](https://github.com/WalletConnect/WalletConnectFlutterV2/blob/develop/example/wallet/ios/Runner/AppDelegate.swift) as a reference.

</PlatformTabItem>
<PlatformTabItem value="android">

1. Ensure to handle incoming app links in your Activity onCreate method and in onNewIntent callback.
2. Ensure that your App Link is properly configured in your app's Manifest file with the `autoVerify` set to `true`:
```xml
<intent-filter android:autoVerify="true">
  <action android:name="android.intent.action.VIEW" />

  <category android:name="android.intent.category.DEFAULT" />
  <category android:name="android.intent.category.BROWSABLE" />

  <data android:scheme="https" />
  <data android:host="your_wallet_universal_link.com" />
  <data android:pathPattern="/open" />
</intent-filter>
```
3. Update/Create your Domain's `.well-known/assetlinks.json` file accordingly

For more information on how to configure app links for your app, refer to the [Android Documentation](https://developer.android.com/training/app-links/verify-android-applinks).<br />
For enabling links to app content check [this](https://developer.android.com/training/app-links/deep-linking) documentation page.<br />
For more information on how to interact with other apps using intents, see [Android Intent Documentation](https://developer.android.com/training/basics/intents).

You can check our Flutter Sample Wallet's [MainActivity file](https://github.com/WalletConnect/WalletConnectFlutterV2/blob/develop/example/wallet/android/app/src/main/kotlin/com/example/wallet/MainActivity.kt) as a reference.

</PlatformTabItem>
</PlatformTabs>
